<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="swith.followmappertest">

	<resultMap type="followDtoTest" id="followMapTest">
		<id property="followNo" column="FOLLOW_NO"/>
		<result property="activeUser" column="ACTIVE_USER"/>
		<result property="passiveUser" column="PASSIVE_USER"/>
		<result property="regDate" column="REGDATE"/>
		
		<result property="activeUserId" column="ACTIVE_USER_ID"/>
		<result property="passiveUserId" column="PASSIVE_USER_ID"/>
		
		<result property="profileName" column="PROFILE_NAME"/>
	</resultMap>
	
	<resultMap type="userDtoTest" id="userMapTest">
		<id property="userNo" column="USER_NO"/>
		<result property="id" column="USER_ID" />
		<result property="name" column="USER_NAME" />
		<result property="regDate" column="REGDATE" />
	</resultMap>
	
	<!-- 팔로우 -->
	<insert id="follow">
		INSERT INTO FOLLOWTEST(ACTIVE_USER, PASSIVE_USER)
		VALUE(#{activeUser}, #{passiveUser})
	</insert>
	
	<!-- 언팔로우 -->
	<delete id="unfollow">
		DELETE FROM FOLLOWTEST
		WHERE ACTIVE_USER=#{activeUser} and PASSIVE_USER=#{passiveUser}
	</delete>
	
	<!-- 팔로우 유무 조회 -->
	<select id="isFollow">
		SELECT COUNT(*)
		FROM FOLLOWTEST
		WHERE ACTIVE_USER=#{activeUser} AND PASSIVE_USER=#{passiveUser}
	</select>
	
	<!-- 팔로우 리스트 조회 -->
	<select id="selectActiveList" resultMap="followMapTest">
		SELECT ACTIVE_USER, PASSIVE_USER, F.REGDATE AS REGDATE, U.ID AS PASSIVE_USER_ID, I.PROFILE_NAME AS PROFILE_NAME
		FROM FOLLOWTEST F 
		LEFT OUTER JOIN USERTEST U ON (F.PASSIVE_USER = U.USER_NO)
		WHERE ACTIVE_USER=#{activeUser}
		ORDER BY REGDATE DESC
	</select>


</mapper>
